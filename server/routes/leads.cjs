const express=require("express");const fs=require("fs");const path=require("path");const router=express.Router();const LEADS_PATH=path.join(process.cwd(),"server","files","leads.json");const ADMIN_TOKEN=process.env.ADMIN_TOKEN||"";function readLeads(){try{return JSON.parse(fs.readFileSync(LEADS_PATH,"utf8"))}catch{return[]}}function writeLeads(a){fs.mkdirSync(path.dirname(LEADS_PATH),{recursive:true});fs.writeFileSync(LEADS_PATH,JSON.stringify(a,null,2))}router.post("/leads",(req,res)=>{try{const{email,name,note}=req.body||{};if(!email)return res.status(400).json({ok:false,error:"email_required"});const id=Date.now().toString(36);const createdAt=new Date().toISOString();const rec={id,email,name,note,createdAt};const arr=readLeads();arr.push(rec);writeLeads(arr);res.json({ok:true,id,createdAt})}catch(e){res.status(500).json({ok:false,error:String(e?.message||e)})}});router.get("/self/leads",(req,res)=>{const arr=readLeads().sort((a,b)=>String(b.createdAt).localeCompare(String(a.createdAt))).slice(0,50);res.json(arr)});module.exports=router;
